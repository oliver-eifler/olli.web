!function(){"use strict";function a(){function a(a){return"function"==typeof a}function b(a,b){n.add(a,b),m||(m=o(n.drain))}function c(b){var c,d=typeof b;return null==b||"object"!=d&&"function"!=d||(c=b.then),a(c)?c:!1}function d(){for(var a=0;a<this.chain.length;a++)e(this,1===this.state?this.chain[a].success:this.chain[a].failure,this.chain[a]);this.chain.length=0}function e(a,b,d){var e,f;try{b===!1?d.reject(a.msg):(e=b===!0?a.msg:b.call(void 0,a.msg),e===d.promise?d.reject(TypeError("Promise-chain cycle")):(f=c(e))?f.call(e,d.resolve,d.reject):d.resolve(e))}catch(g){d.reject(g)}}function f(a){var e,h=this;if(!h.triggered){h.triggered=!0,h.def&&(h=h.def);try{(e=c(a))?b(function(){var b=new i(h);try{e.call(a,function(){f.apply(b,arguments)},function(){g.apply(b,arguments)})}catch(c){g.call(b,c)}}):(h.msg=a,h.state=1,h.chain.length>0&&b(d,h))}catch(j){g.call(new i(h),j)}}}function g(a){var c=this;c.triggered||(c.triggered=!0,c.def&&(c=c.def),c.msg=a,c.state=2,c.chain.length>0&&b(d,c))}function h(a,b,c,d){for(var e=0;e<b.length;e++)!function(e){a.resolve(b[e]).then(function(a){c(e,a)},d)}(e)}function i(a){this.def=a,this.triggered=!1}function j(a){this.promise=a,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function k(c){if(!a(c))throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var e=new j(this);this.then=function(c,f){var g={success:a(c)?c:!0,failure:a(f)?f:!1};return g.promise=new this.constructor(function(b,c){if(!a(b)||!a(c))throw TypeError("Not a function");g.resolve=b,g.reject=c}),e.chain.push(g),0!==e.state&&b(d,e),g.promise},this["catch"]=function(a){return this.then(void 0,a)};try{c.call(void 0,function(a){f.call(e,a)},function(a){g.call(e,a)})}catch(h){g.call(e,h)}}var l,m,n,o=(Object.prototype.toString,"undefined"!=typeof setImmediate?function(a){return setImmediate(a)}:setTimeout),p=Array.isArray;try{Object.defineProperty({},"x",{}),l=function(a,b,c,d){return Object.defineProperty(a,b,{value:c,writable:!0,configurable:d!==!1})}}catch(q){l=function(a,b,c){return a[b]=c,a}}n=function(){function a(a,b){this.fn=a,this.self=b,this.next=void 0}var b,c,d;return{add:function(e,f){d=new a(e,f),c?c.next=d:b=d,c=d,d=void 0},drain:function(){var a=b;for(b=c=m=void 0;a;)a.fn.call(a.self),a=a.next}}}();var r=l({},"constructor",k,!1);return k.prototype=r,l(r,"__NPO__",0,!1),l(k,"resolve",function(b){var c=this;return b&&"object"==typeof b&&1===b.__NPO__?b:new c(function(c,d){if(!a(c)||!a(d))throw TypeError("Not a function");c(b)})}),l(k,"reject",function(b){return new this(function(c,d){if(!a(c)||!a(d))throw TypeError("Not a function");d(b)})}),l(k,"all",function(b){var c=this;return p(b)?0===b.length?c.resolve([]):new c(function(d,e){if(!a(d)||!a(e))throw TypeError("Not a function");var f=b.length,g=Array(f),i=0;h(c,b,function(a,b){g[a]=b,++i===f&&d(g)},e)}):c.reject(TypeError("Not an array"))}),l(k,"race",function(b){var c=this;return p(b)?new c(function(d,e){if(!a(d)||!a(e))throw TypeError("Not a function");h(c,b,function(a,b){d(b)},e)}):c.reject(TypeError("Not an array"))}),k}var b=window,c="Promise";b[c]=b[c]||a()}();